# Debug Guide - Отладка LLM запросов

## Функция debug_print_messages

Функция `debug_print_messages()` в модуле `llm_client.py` позволяет визуализировать структуру всех сообщений, отправляемых в LLM API.

### Возможности

✨ **Красивый вывод** с цветовой подсветкой для разных ролей:
- 🤖 **Assistant** - синий
- 👤 **User** - зелёный  
- ⚙️ **System** - фиолетовый

📊 **Статистика**: показывает общее количество сообщений и символов

🎨 **Панели Rich**: каждое сообщение в отдельной панели с рамкой

✂️ **Автообрезка**: длинные сообщения (>500 символов) автоматически обрезаются для читаемости

### Способы включения

#### 1. Через переменную окружения (рекомендуется для разработки)

```bash
# Linux/Mac
export PT_DEBUG=1
pt "ваш запрос"

# Windows (PowerShell)
$env:PT_DEBUG="1"
pt "ваш запрос"

# Windows (CMD)
set PT_DEBUG=1
pt "ваш запрос"
```

#### 2. Через конфигурацию

Добавьте в `config.yaml`:

```yaml
global:
  debug_mode: true
```

Или через меню настроек:
```bash
pt --settings
```

#### 3. Программно (для тестирования)

```python
from penguin_tamer.llm_client import debug_print_messages

messages = [
    {"role": "system", "content": "You are a helpful assistant."},
    {"role": "user", "content": "Hello! How are you?"},
    {"role": "assistant", "content": "I'm doing great, thank you!"}
]

debug_print_messages(messages, model="gpt-4", temperature=0.7)
```

### Пример вывода

```
================================================================================
🔍 LLM Request Debug | Model: microsoft/mai-ds-r1:free | Temp: 0.8
================================================================================

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ ⚙️ Message #1: SYSTEM                                                      ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│                                                                             │
│  Your name is Penguin Tamer, a sysadmin assistant.                         │
│  You and the user always work in a terminal.                               │
│  Respond based on the user's environment and commands.                     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 👤 Message #2: USER                                                        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│                                                                             │
│  ALWAYS number code blocks in your replies...                              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 👤 Message #3: USER                                                        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│                                                                             │
│  Как создать файл в Linux?                                                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

Total messages: 3 | Total characters: 423
================================================================================
```

### Применение

🐛 **Отладка промптов**: проверьте, что именно отправляется в модель

📝 **Разработка**: отладка educational prompts и system prompts

🔍 **Диагностика**: найдите причину неожиданных ответов модели

💡 **Обучение**: изучите структуру диалога с LLM

### Примечания

- Режим отладки автоматически останавливает спиннер для чистого вывода
- После показа отладочной информации спиннер перезапускается
- Длинные сообщения обрезаются с указанием общей длины
- Функция использует ленивую загрузку Rich компонентов для быстрого старта

### Отключение

```bash
# Linux/Mac
unset PT_DEBUG

# Windows (PowerShell)
Remove-Item Env:PT_DEBUG

# Windows (CMD)
set PT_DEBUG=
```

Или установите `debug_mode: false` в конфиге.
